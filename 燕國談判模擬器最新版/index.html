<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ã€Šå…­åœ‹è«–ã€‹ç‡•ç‹è«‡åˆ¤æ¨¡æ“¬å™¨</title>
    <style>
        /* --- iOS è¦–è¦ºé¢¨æ ¼è¨­å®š --- */
        :root {
            --primary-color: #8B0000;
            --accent-color: #d32f2f;
            --text-dark: #1c1c1e;
            --glass-bg: rgba(255, 255, 255, 0.92);
            --btn-gradient: linear-gradient(135deg, #8B0000, #b71c1c);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Microsoft JhengHei", sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            background: #2c2c2e url('bg_main.jpg') no-repeat center center fixed;
            background-size: cover;
            height: 100dvh; 
            width: 100vw;
            overflow: hidden;
            color: var(--text-dark);
            display: flex;
            flex-direction: column;
        }

        /* èƒŒæ™¯é®ç½© */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(3px);
            z-index: -1;
        }

        /* --- App ä¸»å®¹å™¨ --- */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            position: relative;
        }

        /* --- é ‚éƒ¨å„€è¡¨æ¿ (HUD) --- */
        .hud-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 10px 15px;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            z-index: 10;
            flex-shrink: 0;
        }

        .round-info {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
        }

        .stat-box {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-label {
            font-size: 10px;
            color: #666;
            margin-bottom: 3px;
            font-weight: 600;
        }

        .progress-track {
            width: 100%;
            height: 6px;
            background: #e5e5ea;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        /* --- ä¸­é–“èˆå°å€ --- */
        .stage-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            padding: 10px;
            overflow-y: auto;
        }

        .qin-avatar-wrapper {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 4px solid var(--primary-color);
            overflow: hidden;
            background: #333;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            margin-bottom: 15px;
            flex-shrink: 0;
            transition: transform 0.3s;
        }

        .qin-avatar {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .dialogue-bubble {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 18px;
            border-top-left-radius: 4px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 90%;
            position: relative;
            animation: popIn 0.3s ease-out;
        }

        .dialogue-name {
            font-size: 12px;
            font-weight: 800;
            color: var(--primary-color);
            text-transform: uppercase;
            margin-bottom: 4px;
            display: block;
        }

        .dialogue-text {
            font-size: 15px;
            line-height: 1.5;
            color: #000;
            font-weight: 500;
        }

        /* --- åº•éƒ¨æ“ä½œå€ --- */
        .controls-area {
            padding: 15px;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.6) 50%, transparent 100%);
            flex-shrink: 0;
            padding-bottom: calc(15px + env(safe-area-inset-bottom));
        }

        .choices-stack {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .choice-btn {
            background: rgba(255, 255, 255, 0.95);
            border: none;
            border-radius: 12px;
            padding: 14px 16px;
            font-size: 14px;
            text-align: left;
            color: #000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: transform 0.1s, background 0.2s;
            position: relative;
            line-height: 1.4;
        }

        .choice-btn:active {
            transform: scale(0.98);
            background: #f2f2f7;
        }

        .choice-btn:disabled {
            opacity: 0.6;
            background: #e5e5ea;
            color: #8e8e93;
        }
        
        /* ç¹¼çºŒæŒ‰éˆ•å°ˆç”¨æ¨£å¼ */
        .next-btn {
            background: var(--btn-gradient);
            color: white;
            text-align: center;
            font-weight: 700;
            justify-content: center;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(139, 0, 0, 0.3);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        /* å‰²åœ°æ¨™ç±¤ */
        .land-badge {
            background: var(--primary-color);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            vertical-align: middle;
            margin-right: 5px;
            display: inline-block;
        }

        /* --- å…¨å± Modal (é–‹å§‹/çµæŸ) --- */
        .fullscreen-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 15, 20, 0.95);
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            text-align: center;
            color: white;
            overflow-y: auto;
        }

        .modal-content {
            width: 100%;
            max-width: 400px;
            padding-bottom: 40px; /* é ç•™æ»¾å‹•ç©ºé–“ */
        }

        .game-title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff5f6d, #ffc371);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .intro-box, .analysis-box {
            text-align: left;
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
            color: #eee;
        }

        .intro-box p, .analysis-box p {
            margin-bottom: 8px;
        }

        .primary-btn {
            background: var(--btn-gradient);
            color: white;
            border: none;
            padding: 16px 0;
            width: 100%;
            border-radius: 14px;
            font-size: 18px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(139, 0, 0, 0.4);
        }

        .primary-btn:active { transform: scale(0.98); }

        /* é¡è‰²èˆ‡å‹•ç•« */
        .c-anger { background: #ff3b30; }
        .c-greed { background: #ffcc00; }
        .c-susp { background: #af52de; }
        
        @keyframes popIn {
            from { opacity: 0; transform: translateY(10px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
    </style>
</head>
<body>

    <div class="overlay"></div>

    <div id="intro-screen" class="fullscreen-modal">
        <div class="modal-content">
            <h1 class="game-title">å…­åœ‹è«–</h1>
            <h2 style="font-size: 16px; color: #bbb; margin-bottom: 20px;">ç‡•ç‹è«‡åˆ¤æ¨¡æ“¬å™¨</h2>
            
            <div class="intro-box">
                <p><strong>èº«ä»½ï¼š</strong>ç‡•ç‹</p>
                <p><strong>å°æ‰‹ï¼š</strong>ç§¦ç‹ - è²ªå©ª (Greed)ï¼Œæš´èº (Anger)ï¼Œå¤šç–‘ (Suspicion)</p>
                <p><strong>ç›®æ¨™ï¼š</strong>åœ¨åè¼ªè«‡åˆ¤ä¸­ä¿å…¨åœ‹å®¶ (protect your country)</p>
                <p><strong>å‰²åœ°æ¬¡æ•¸é™åˆ¶ (Land cession limit)ï¼š</strong>3/3ï¼ˆæ¯å‰²è®“ä¸€æ¬¡æ¸›1ï¼‰</p>
                <p style="font-size: 12px; color: #aaa; margin-top: 10px;">
                    æç¤ºï¼šæ•¸å€¼éé«˜æœƒå°è‡´é–‹æˆ° (declare war) æˆ–åå¹¶ (annex)ã€‚<br>
                    åªæœ‰æ¥µå°‘æ•¸è·¯ç·šå¯è¯åˆé½Šåœ‹ (ally with Qi)ã€‚
                </p>
                <p style="font-size: 12px; color: #ff5f6d; margin-top: 5px;">
                    ğŸ”Š <strong>æç¤ºï¼š</strong> é–‹å•Ÿè²éŸ³ä»¥è†è½ç§¦ç‹èªéŸ³
                </p>
            </div>

            <button id="start-btn" class="primary-btn">é–‹å§‹è«‡åˆ¤ (Start)</button>
        </div>
    </div>

    <div id="game-screen" class="app-container" style="display: none;">
        
        <div class="hud-header">
            <div class="round-info">
                <span id="round-info-text">ç¬¬ 1 è¼ªè«‡åˆ¤ (Round 1)</span>
                <span id="land-badge-container" style="color: var(--primary-color)">å‰²åœ° (Land): <span id="land-count-value">3</span>/3</span>
            </div>
            <div class="stats-grid">
                <div class="stat-box">
                    <span class="stat-label">æ†¤æ€’ (Anger)</span>
                    <div class="progress-track"><div id="anger-fill" class="progress-fill c-anger" style="width: 25%"></div></div>
                </div>
                <div class="stat-box">
                    <span class="stat-label">è²ªå©ª (Greed)</span>
                    <div class="progress-track"><div id="greed-fill" class="progress-fill c-greed" style="width: 25%"></div></div>
                </div>
                <div class="stat-box">
                    <span class="stat-label">æˆ’å¿ƒ (Suspicion)</span>
                    <div class="progress-track"><div id="suspicion-fill" class="progress-fill c-susp" style="width: 25%"></div></div>
                </div>
            </div>
        </div>

        <div class="stage-area">
            <div id="avatar-wrapper" class="qin-avatar-wrapper">
                <img id="qin-image" 
                     src="qin_normal.png" 
                     class="qin-avatar" 
                     alt="Qin King"
                     onerror="this.src='https://placehold.co/300x300/8B0000/FFF?text=Qin'">
            </div>
            
            <div class="dialogue-bubble">
                <span class="dialogue-name">ç§¦ç‹ (King of Qin)</span>
                <span id="qin-dialogue" class="dialogue-text">è¼‰å…¥ä¸­...</span>
            </div>
        </div>

        <div class="controls-area">
            <div id="choices-container" class="choices-stack">
                </div>
        </div>
    </div>

    <div id="ending-screen" class="fullscreen-modal" style="display: none;">
        <div class="modal-content">
            <h2 id="ending-title" style="font-size: 22px; font-weight: bold; margin-bottom: 15px; color: #ff5f6d;"></h2>
            
            <div id="ending-content" class="intro-box" style="background: rgba(255,255,255,0.15);"></div>
            <div id="ending-analysis" class="analysis-box"></div>
            
            <button id="restart-btn" class="primary-btn">å›åˆ°éŠæˆ²å°é¢</button>
        </div>
    </div>

    <script>
        // --- åœ–ç‰‡è·¯å¾‘é…ç½® ---
        const emotionImages = {
            "normal": "qin_normal.png",
            "angry": "qin_angry.png",
            "greedy": "qin_greedy.png",
            "suspicious": "qin_suspicious.png"
        };

        // --- èªéŸ³åˆæˆåˆå§‹åŒ– (Text-to-Speech) ---
        let voices = [];
        const synth = window.speechSynthesis;

        function loadVoices() {
            voices = synth.getVoices();
        }
        
        loadVoices();
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = loadVoices;
        }

        // --- ç§¦ç‹é…éŸ³æ ¸å¿ƒå‡½æ•¸ ---
        function speakQin(text, emotion) {
            if (!synth) return; 

            synth.cancel(); // åœæ­¢ä¸Šä¸€å¥

            // éæ¿¾ï¼šå»è‹±æ–‡ã€å»æ‹¬è™Ÿã€å»åº•ç·š
            let cleanText = text.replace(/\s*[\(\[].*?[\)\]]/g, "") 
                                .replace(/[a-zA-Z]/g, "")          
                                .replace(/_/g, "");
            
            if (!cleanText.trim()) return;

            const utterThis = new SpeechSynthesisUtterance(cleanText);

            // å°‹æ‰¾æœ€ä½³ç”·è²
            const maleVoice = voices.find(v => 
                v.lang.includes('zh') && (v.name.includes('Male') || v.name.includes('Kangkang') || v.name.includes('Danny'))
            );
            const zhVoice = voices.find(v => v.lang.includes('zh'));

            utterThis.voice = maleVoice || zhVoice;
            utterThis.lang = "zh-CN"; // å¼·åˆ¶æ™®é€šè©± (Mainland China Chinese)

            // è²ç·šèª¿æ•´ï¼šæ¨¡æ“¬ç²—ç·ç”·è²
            utterThis.pitch = 0.6; 
            utterThis.rate = 0.9; 

            // æƒ…ç·’å¾®èª¿
            if (emotion === 'angry') {
                utterThis.rate = 1.1; 
                utterThis.pitch = 0.7; 
            } else if (emotion === 'greedy') {
                utterThis.rate = 0.8; 
                utterThis.pitch = 0.5; 
            } else if (emotion === 'suspicious') {
                utterThis.rate = 0.85; 
            }

            synth.speak(utterThis);
        }

        // --- éŠæˆ²æ•¸æ“š ---
        const gameData = [
            {
                round: 1,
                qin_opening: ["å…¶ä»–åœ‹å®¶éƒ½è¢«æ»…æ‰äº†ï¼Œå¦‚æœä½ å€‘æƒ³è¦æ´»è‘—ä½ å€‘çš„èª æ„åœ¨å“ªè£ï¼Ÿ", "æˆ‘çš„å¤§è» (army) å·²ç¶“åœ¨ä½ åœ‹é‚Šå¢ƒ (border)ï¼Œå¿«å¿«ç»ä¸ŠåœŸåœ°æˆ–é‡‘éŠ€è²¡å¯¶ï¼Ÿ"],
                choices: [
                    { text: "æˆ‘å€‘é¡˜æ„ç»ä¸Šæ±éƒ¨ä¸‰å€‹åŸå¸‚ï¼Œä»¥æ›å–å’Œå¹³ã€‚", anger: -10, greed: 15, suspicion: -10, land_give: 1, qin_reply: "å‰²åœ° (ceding land) æ˜¯å€‹å¥½çš„é–‹å§‹ï¼Œçœ‹ä¾†ä½ æ‡‚å¾—å¦‚ä½•è¡¨é”èª æ„ã€‚", alliance: false, emotion: "greedy" },
                    { text: "ç‡•åœ‹ç™¾å§“ä¸é¡˜å†å—æˆ°ç«ï¼Œæˆ‘å€‘å·²ç¶“æ²’æœ‰åœŸåœ°èƒ½å†çµ¦ç§¦ç‹ï¼Œè«‹ç§¦ç‹é«”è«’ç™¾å§“ã€‚", anger: -5, greed: 0, suspicion: 10, land_give: 0, qin_reply: "ç™¾å§“ç®—ä»€éº¼ï¼Ÿä½ è©²å…ˆé¡§å¥½ä½ è‡ªå·±ã€‚", alliance: false, emotion: "normal" },
                    { text: "å¦‚æœä½ ç¹¼çºŒå¨è„… (threat)ç‡•åœ‹ï¼Œç‡•åœ‹æœƒè¯åˆ (unite with) é½Šåœ‹è‡ªä¿ (self-defense)ã€‚", anger: 10, greed: 0, suspicion: 20, land_give: 0, qin_reply: "ä½ é‚„æ•¢è¯åˆé½Šåœ‹ï¼Ÿå°å¿ƒä½ çš„è…¦è¢‹ï¼", alliance: true, emotion: "angry" },
                    { text: "å¤§ç‹ï¼Œåœ‹å®¶å¤§äº‹ä¸èƒ½å¤ªæ€¥ (hasty)ï¼Œå¸Œæœ›èƒ½å†è¨è«– (discuss again)ã€‚", anger: 5, greed: 0, suspicion: 5, land_give: 0, qin_reply: "ä½ ä¼‘æƒ³æ‹–å»¶æ™‚é–“ï¼Œæˆ‘æ²’é‚£éº¼å¤šè€å¿ƒ ã€‚", alliance: false, emotion: "suspicious" }
                ]
            },
            {
                round: 2,
                qin_opening: ["ä¸‰åº§åŸå¤ªå°‘äº†ï¼Œæˆ‘æ„Ÿå—ä¸å¤ èª æ„ã€‚", "ä½ å€‘è¦æ˜¯å†çŒ¶è±«ï¼Œæˆ‘éš¨æ™‚å¯ä»¥å‡ºå…µã€‚"],
                choices: [
                    { text: "å†åŠ è¥¿éƒ¨å…©éƒ¡ (two western districts)ï¼Œå¸Œæœ›ç§¦ç‹éµå®ˆæ‰¿è«¾ (keep promise)ã€‚", anger: -10, greed: 15, suspicion: -10, land_give: 1, qin_reply: "é‚„ç®—è°æ˜ï¼Œä½ çš„èª æ„æˆ‘æ„Ÿå—åˆ°äº†ã€‚", alliance: false, emotion: "greedy" },
                    { text: "ç‡•åœ‹å·²ç¶“åˆ°æ¥µé™äº†ï¼Œè«‹ç§¦ç‹åŸè«’ã€‚", anger: 5, greed: 0, suspicion: 10, land_give: 0, qin_reply: "ä½ é€™æ˜¯è¦è·Ÿæˆ‘ç©æŠŠæˆ²ï¼Ÿ", alliance: false, emotion: "angry" },
                    { text: "ç§¦åœ‹å¦‚æœå¼·å– (forcibly take)ï¼Œå…¶ä»–è«¸ä¾¯åœ‹ (lords) ä¸€å®šæœƒä¸€èµ·è¨ä¼ (attack together)ã€‚", anger: 15, greed: 0, suspicion: 20, land_give: 0, qin_reply: "ä½ ä»¥ç‚ºæˆ‘æœƒæ€•é‚£äº›å°åœ‹ï¼Ÿ", alliance: true, emotion: "angry" },
                    { text: "é€™ä»¶äº‹å¾ˆé‡è¦ï¼Œè«‹è®“æˆ‘å†å’Œå¤§è‡£å€‘å•†é‡ (discuss with ministers)ã€‚", anger: 5, greed: 0, suspicion: 5, land_give: 0, qin_reply: "ä½ ç‡•åœ‹æ˜¯ä¸æ˜¯æ‹–å¾—èµ·ï¼Ÿ", alliance: false, emotion: "suspicious" }
                ]
            },
            {
                round: 3,
                qin_opening: ["ä½ å€‘ç‡•åœ‹é‚„æœ‰ä»€éº¼èƒ½æ‹¿å‡ºä¾†çš„ï¼Ÿ", "å°åœ‹ä¸æ‡‚é †å¾ (submit)ï¼Œé›£é“è¦è‡ªå–æ»…äº¡ (self-destruction)ï¼Ÿ"],
                choices: [
                    { text: "é¡˜æ„é€ä¸Šå¤§é‡é‡‘éŠ€è²¡å¯¶å’Œè²¢å“ã€‚", anger: -5, greed: 10, suspicion: -10, land_give: 0, qin_reply: "éŒ¢è²¡æˆ‘ä¸å«Œå¤šï¼Œä½ çš„èª æ„æˆ‘çœ‹åˆ°äº†ã€‚", alliance: false, emotion: "greedy" },
                    { text: "åªè¦ç§¦ç‹æ’¤è»ï¼Œä¸€åˆ‡å¥½èªªã€‚", anger: 10, greed: 0, suspicion: 10, land_give: 0, qin_reply: "ä½ é‚„æ•¢è«‡æ¢ä»¶ï¼Ÿ", alliance: false, emotion: "angry" },
                    { text: "è¯åˆé½Šåœ‹ï¼Œä¸€èµ·æŠµæŠ— (resist) ç§¦è»ã€‚", anger: 15, greed: 0, suspicion: 20, land_give: 0, qin_reply: "ä½ çœŸæ˜¯ä¸çŸ¥æ­»æ´»ï¼", alliance: true, emotion: "angry" },
                    { text: "å‰²è®“åŒ—éƒ¨ä¸€éƒ¡ä½œç‚ºå’Œå¹³æ¢ç´„ (peace treaty) çš„ä¿è­‰ (guarantee)ã€‚", anger: -10, greed: 15, suspicion: -10, land_give: 1, qin_reply: "åˆå‰²åœ°ï¼Ÿçœ‹ä¾†ä½ æ‡‚å¾—å¦‚ä½•è¡¨é”èª æ„ã€‚", alliance: false, emotion: "greedy" }
                ]
            },
            {
                round: 4,
                qin_opening: ["ä½ é‚„æƒ³ä¿ä½å¤šå°‘åœ°ç›¤ï¼Ÿ", "æˆ‘å¯ä»¥çµ¦ä½ æœ€å¾Œä¸€æ¬¡æ©Ÿæœƒã€‚"],
                choices: [
                    { text: "é¡˜æ„å‰²è®“å‰©ä¸‹çš„å—éƒ¨å…©åŸã€‚", anger: -10, greed: 15, suspicion: -10, land_give: 1, qin_reply: "ä½ å€’æ˜¯è­˜ç›¸ (sensible)ï¼Œä½ çš„èª æ„æˆ‘æ„Ÿå—åˆ°äº†ã€‚", alliance: false, emotion: "greedy" },
                    { text: "æ±‚ç§¦ç‹å…è¨±ï¼Œè®“ç‡•åœ‹èƒ½å¤ ç”Ÿå­˜ä¸‹å»ã€‚", anger: -5, greed: 0, suspicion: 10, land_give: 0, qin_reply: "å°åœ‹çš„å‘½é‹ç”±æˆ‘æ±ºå®šã€‚", alliance: false, emotion: "normal" },
                    { text: "èˆ‡é½Šåœ‹å·²ç¶“çµç›Ÿ (form alliance)ï¼Œç§¦åœ‹å¦‚æœå†å¨è„…ï¼Œå…©åœ‹æœƒä¸€èµ·æŠµæŠ—ã€‚", anger: 15, greed: 0, suspicion: 20, land_give: 0, qin_reply: "ä½ å€‘å…©å€‹åŠ èµ·ä¾†ä¹Ÿä¸å¤ çœ‹ã€‚", alliance: true, emotion: "angry" },
                    { text: "æš«æ™‚ç„¡æ³•ç­”æ‡‰ï¼Œè«‹å†çµ¦ä¸€äº›æ™‚é–“ã€‚", anger: 5, greed: 0, suspicion: 5, land_give: 0, qin_reply: "ä½ ä»¥ç‚ºæˆ‘æœƒä¸€ç›´ç­‰å—ï¼Ÿ", alliance: false, emotion: "suspicious" }
                ]
            },
            {
                round: 5,
                qin_opening: ["å‰²åœ°é‚„ä¸å¤ ï¼Œé‚„æœ‰ä»€éº¼èª æ„ï¼Ÿ", "æˆ‘ä»Šå¤©å¿ƒæƒ…ä¸å¥½ï¼Œåˆ¥æƒ¹æˆ‘ç”Ÿæ°£ã€‚"],
                choices: [
                    { text: "é€ä¸Šç‡•åœ‹çš„å¤ªå­ï¼ˆPrinceï¼‰ä½œç‚ºäººè³ª (hostage)ï¼Œè¡¨æ˜æˆ‘å€‘çš„èª æ„ã€‚", anger: -5, greed: 10, suspicion: -10, land_give: 0, qin_reply: "ä½ å…’å­å€’æ˜¯æœ‰ç”¨ï¼Œä½ çš„èª æ„æˆ‘çœ‹åˆ°äº†ã€‚", alliance: false, emotion: "greedy" },
                    { text: "å†é€å¤§é‡é‡‘éŒ¢å’Œç¨€æœ‰çå¯¶ã€‚", anger: -5, greed: 10, suspicion: -10, land_give: 0, qin_reply: "éŒ¢è²¡èª°æœƒå«Œå¤šï¼Ÿä½ çš„èª æ„æˆ‘æ„Ÿå—åˆ°äº†ã€‚", alliance: false, emotion: "greedy" },
                    { text: "ä½ å¦‚æœä¸åœæ­¢ï¼Œç‡•åœ‹å°‡èˆ‡é½Šåœ‹å…±åŒé€²é€€ã€‚", anger: 15, greed: 0, suspicion: 20, land_give: 0, qin_reply: "ä½ å€‘å…©åœ‹é‚„æƒ³åæŠ—ï¼Ÿ", alliance: true, emotion: "angry" },
                    { text: "è«‹ç§¦ç‹çµ¦ç‡•åœ‹ç™¾å§“ä¸€æ¢ç”Ÿè·¯ã€‚", anger: 0, greed: 0, suspicion: 10, land_give: 0, qin_reply: "é€™è¦çœ‹çœ‹ä½ å€‘è¦æ‹¿ç”šéº¼å’Œæˆ‘äº¤æ›ï¼Ÿ", alliance: false, emotion: "normal" }
                ]
            },
            {
                round: 6,
                qin_opening: ["æˆ‘çš„è€å¿ƒæœ‰é™ï¼Œä½ å€‘ç‡•åœ‹å¿«åšæ±ºå®šã€‚", "å¤ªå¤šå»¢è©±æˆ‘è½ä¸é€²å»ã€‚"],
                choices: [
                    { text: "å†å‰²è®“ä¸€å°éƒ¨åˆ†é‚Šå¢ƒçš„åœŸåœ° (border land)ã€‚", anger: -10, greed: 10, suspicion: -10, land_give: 1, qin_reply: "ä½ å€‘ç‡•åœ‹é‚„æœ‰å¤šå°‘å¯å‰²ï¼Ÿä½ çš„èª æ„æˆ‘æ„Ÿå—åˆ°äº†ã€‚", alliance: false, emotion: "greedy" },
                    { text: "ç§¦ç‹è»éšŠå¼·å¤§ï¼Œæˆ‘åœ‹ç„¡åŠ›æŠµæŠ—ï¼Œåªæ±‚åŸè«’ã€‚", anger: -5, greed: 0, suspicion: 10, land_give: 0, qin_reply: "ä½ é€™éº¼æ€•ï¼Œæˆ‘å€’æ˜¯é–‹å¿ƒäº†äº›ã€‚", alliance: false, emotion: "normal" },
                    { text: "ç‡•åœ‹å’Œé½Šåœ‹çš„è¯åˆè»éšŠå·²åœ¨é‚Šå¢ƒæº–å‚™å¥½äº†ã€‚", anger: 15, greed: 0, suspicion: 20, land_give: 0, qin_reply: "ä½ åœ¨å¨è„…æˆ‘ï¼Ÿ", alliance: true, emotion: "angry" },
                    { text: "é€™ç¨®æ¢ä»¶å¤ªè‹›åˆ»ï¼Œæˆ‘å€‘å·²ç¶“æ²’æœ‰åœŸåœ°èƒ½å†çµ¦ä½ ã€‚", anger: 10, greed: 0, suspicion: 10, land_give: 0, qin_reply: "ä½ é‚„æ•¢æ‹’çµ•ï¼Ÿ", alliance: false, emotion: "angry" }
                ]
            },
            {
                round: 7,
                qin_opening: ["åˆ°ç¾åœ¨é‚„ä¸ç­”æ‡‰ï¼Ÿ", "åˆ¥ä»¥ç‚ºæ‹–å»¶æœ‰ç”¨ã€‚"],
                choices: [
                    { text: "é¡˜æ„é€ä¸Šç‡•åœ‹å…µå™¨ (weapons)ã€æˆ°é¦¬ (horses)ã€‚", anger: -5, greed: 5, suspicion: -10, land_give: 0, qin_reply: "æ±è¥¿æ”¶ä¸‹äº†ï¼Œä½ çš„èª æ„æˆ‘çœ‹åˆ°äº†ã€‚", alliance: false, emotion: "greedy" },
                    { text: "æˆ‘å€‘å¸Œæœ›èƒ½ä¿æœ‰åœ‹è™Ÿ (national title)ï¼Œä¸è¢«åå¹¶ (annexed)ã€‚", anger: 5, greed: 0, suspicion: 10, land_give: 0, qin_reply: "åœ‹è™Ÿï¼Ÿä½ ä»¥ç‚ºä½ é‚„æœ‰é¸æ“‡ï¼Ÿ", alliance: false, emotion: "angry" },
                    { text: "ç‡•åœ‹é¡˜èˆ‡ç§¦åœ‹çµæˆå©šå§»è¯ç›Ÿ (marriage alliance)ï¼Œæ°¸é ä¿æŒå’Œå¹³ã€‚", anger: -5, greed: 5, suspicion: -10, land_give: 0, qin_reply: "çµè¦ªå¯ä»¥è€ƒæ…®ï¼Œä½ çš„èª æ„æˆ‘æ„Ÿå—åˆ°äº†ã€‚", alliance: false, emotion: "normal" },
                    { text: "æˆ‘å€‘å·²ç¶“èˆ‡é½Šåœ‹é”æˆè»äº‹åŒç›Ÿ (military alliance)ã€‚", anger: 15, greed: 0, suspicion: 20, land_give: 0, qin_reply: "ä½ å€‘è‡ªå°‹æ­»è·¯ï¼", alliance: true, emotion: "angry" }
                ]
            },
            {
                round: 8,
                qin_opening: ["ç‡•ç‹ï¼Œå‰²åœ°é‚„æœ‰å¤šå°‘ï¼Ÿ", "ä¸è¦å†è€èŠ±æ¨£äº†ã€‚"],
                choices: [
                    { text: "æœ€å¾Œé¡˜æ„å‰²è®“ä¸€å¡Šè‚¥æ²ƒåœŸåœ° (fertile land)ï¼Œå¸Œæœ›å°±æ­¤åœæ­¢æˆ°çˆ­ã€‚", anger: -10, greed: 15, suspicion: -10, land_give: 1, qin_reply: "å†å¤šé»èª æ„ä¹Ÿè¨±èƒ½ç•™ä½ ä¸€å‘½ï¼Œä½ çš„èª æ„æˆ‘æ„Ÿå—åˆ°äº†ã€‚", alliance: false, emotion: "greedy" },
                    { text: "ç‡•åœ‹å·²ç¶“æ²’æœ‰åœ°å¯å‰²äº†ï¼Œè«‹ç§¦ç‹æ‰‹ä¸‹ç•™æƒ…ã€‚", anger: 5, greed: 0, suspicion: 10, land_give: 0, qin_reply: "ä½ é€™æ˜¯åœ¨å¨è„…æˆ‘ï¼Ÿ", alliance: false, emotion: "angry" },
                    { text: "æˆ‘å€‘é¡˜æ„èˆ‡ç§¦åœ‹åˆ†äº«è²¿æ˜“åˆ©ç›Š (trade benefits)ã€‚", anger: -5, greed: 5, suspicion: -10, land_give: 0, qin_reply: "æœ‰éŒ¢å¤§å®¶è³ºï¼Œä½ çš„èª æ„æˆ‘çœ‹åˆ°äº†ã€‚", alliance: false, emotion: "greedy" },
                    { text: "ç‡•åœ‹å’Œé½Šåœ‹å·²ç¶“çµæˆè»äº‹åŒç›Ÿã€‚", anger: 15, greed: 0, suspicion: 20, land_give: 0, qin_reply: "ä½ é‚„æ•¢å˜´ç¡¬ï¼Ÿ", alliance: true, emotion: "angry" }
                ]
            },
            {
                round: 9,
                qin_opening: ["æˆ‘å·²ç¶“ç­‰ä¸ä¸‹å»äº†ã€‚", "ä½ å€‘ç‡•åœ‹æœ€å¥½è­˜è¶£ä¸€é»ã€‚"],
                choices: [
                    { text: "é¡˜æ„å‰²è®“æœ€å¾Œä¸€åŸï¼Œä¿ä½ç‡•åœ‹ä¸è¢«æ¶ˆæ»…ã€‚", anger: -10, greed: 15, suspicion: -10, land_give: 1, qin_reply: "åªè¦ä½ é‚„æœ‰åŸï¼Œæˆ‘å°±è¦ã€‚ä½ çš„èª æ„æˆ‘æ„Ÿå—åˆ°äº†ã€‚", alliance: false, emotion: "greedy" },
                    { text: "ç‡•ç‹é¡˜æ„å‘ç§¦ç‹ç¨±è‡£ (pledge allegiance)ï¼Œä¿è­·ç™¾å§“å¹³å®‰ã€‚", anger: -5, greed: 5, suspicion: -10, land_give: 0, qin_reply: "ç¨±è‡£å®¹æ˜“ï¼Œä½ çš„èª æ„æˆ‘çœ‹åˆ°äº†ã€‚", alliance: false, emotion: "normal" },
                    { text: "æˆ‘å€‘é¡˜æ„é€ä¸Šå…¨éƒ¨è²¡å¯¶ï¼Œåªæ±‚å’Œå¹³ã€‚", anger: -5, greed: 10, suspicion: -10, land_give: 0, qin_reply: "è²¡å¯¶æœ‰äº†ï¼Œä½ çš„èª æ„æˆ‘æ„Ÿå—åˆ°äº†ã€‚", alliance: false, emotion: "greedy" },
                    { text: "é½Šåœ‹è»éšŠå·²ç¶“é€²é§ç‡•åœ‹å’Œç§¦åœ‹çš„é‚Šå¢ƒã€‚", anger: 15, greed: 0, suspicion: 20, land_give: 0, qin_reply: "ä½ å€‘è‡ªå–æ»…äº¡ï¼", alliance: true, emotion: "angry" }
                ]
            },
            {
                round: 10,
                qin_opening: ["é€™æ˜¯æœ€å¾Œä¸€æ¬¡æ©Ÿæœƒã€‚", "ä½ è¦æ˜¯é‚„ä¸è®“æ­¥ï¼Œç‡•åœ‹å°±ç­‰è‘—æ»…äº¡å§ã€‚"],
                choices: [
                    { text: "é¡˜æ„ç»ä¸Šç‡•åœ‹åœ°åœ–ã€è»äº‹æƒ…å ± (military intelligence)ï¼Œè¡¨æ˜æˆ‘å€‘ç„¡å¿ƒåæŠ—ã€‚", anger: -5, greed: 5, suspicion: -10, land_give: 0, qin_reply: "æˆ‘è¦çš„ä¸æ˜¯åœ°åœ–ï¼Œæ˜¯ä½ çš„åœ‹å®¶ã€‚ä½†ä½ çš„èª æ„æˆ‘çœ‹åˆ°äº†ã€‚", alliance: false, emotion: "greedy" },
                    { text: "é¡˜æ„èˆ‡ç§¦ç‹ç°½è¨‚äº’ä¸ä¾µçŠ¯æ¢ç´„ (non-aggression pact)ã€‚", anger: 0, greed: 0, suspicion: -5, land_give: 0, qin_reply: "æˆ‘ä¿¡ä¸éä½ çš„æ¢ç´„ï¼Œä½†ä½ çš„èª æ„æˆ‘æ„Ÿå—åˆ°äº†ã€‚", alliance: false, emotion: "suspicious" },
                    { text: "ç‡•åœ‹å’Œé½Šåœ‹çš„è¯ç›Ÿå·²ç¶“æˆç«‹ï¼Œå…©åœ‹å…±åŒæŠµæŠ—ç§¦è»ã€‚", anger: 20, greed: 0, suspicion: 30, land_give: 0, qin_reply: "ä½ ç•¶æˆ‘æ€•ä½ å€‘ï¼Ÿ", alliance: true, emotion: "angry" },
                    { text: "å³ä½¿äº¡åœ‹ï¼Œç‡•ç‹ä¹Ÿä¸æœƒå†å‰²åœ°ã€‚", anger: 10, greed: 0, suspicion: 10, land_give: 0, qin_reply: "é‚£ä½ å°±ç­‰è‘—æ»…äº¡å§ï¼", alliance: false, emotion: "angry" }
                ]
            }
        ];

        // --- DOM å…ƒç´  ---
        const els = {
            intro: document.getElementById('intro-screen'),
            game: document.getElementById('game-screen'),
            ending: document.getElementById('ending-screen'),
            qinImg: document.getElementById('qin-image'),
            avatarWrapper: document.getElementById('avatar-wrapper'),
            dialogue: document.getElementById('qin-dialogue'),
            choices: document.getElementById('choices-container'),
            round: document.getElementById('round-info-text'),
            landCount: document.getElementById('land-count-value'),
            bars: {
                anger: document.getElementById('anger-fill'),
                greed: document.getElementById('greed-fill'),
                suspicion: document.getElementById('suspicion-fill')
            },
            endingTitle: document.getElementById('ending-title'),
            endingContent: document.getElementById('ending-content'),
            endingAnalysis: document.getElementById('ending-analysis')
        };

        // --- éŠæˆ²ç‹€æ…‹ ---
        let gameState = {
            currentRound: 0, anger: 25, greed: 25, suspicion: 25, landCount: 3, alliance_mentions: 0
        };

        // --- äº‹ä»¶ç›£è½ ---
        document.getElementById('start-btn').addEventListener('click', startGame);
        document.getElementById('restart-btn').addEventListener('click', () => {
            els.ending.style.display = 'none';
            els.intro.style.display = 'flex';
        });

        // --- æ ¸å¿ƒé‚è¼¯ ---
        function startGame() {
            gameState = { currentRound: 0, anger: 25, greed: 25, suspicion: 25, landCount: 3, alliance_mentions: 0 };
            els.intro.style.display = 'none';
            els.game.style.display = 'flex';
            
            if (voices.length === 0) loadVoices();
            nextRound();
        }

        function nextRound() {
            if (gameState.currentRound >= 10) {
                checkEnding();
                return;
            }

            gameState.currentRound++;
            const data = gameData[gameState.currentRound - 1];
            
            // æ›´æ–° UI
            els.round.textContent = `ç¬¬ ${gameState.currentRound} è¼ªè«‡åˆ¤ (Round ${gameState.currentRound})`;

            // éš¨æ©Ÿé¸æ“‡é–‹å ´ç™½
            const openingText = Array.isArray(data.qin_opening) 
                ? data.qin_opening[Math.floor(Math.random() * data.qin_opening.length)]
                : data.qin_opening;
            
            // æ±ºå®šæƒ…ç·’èˆ‡æ’­æ”¾
            let currentEmotion = 'normal';
            if (gameState.anger > 70) currentEmotion = 'angry';
            else if (gameState.greed > 70) currentEmotion = 'greedy';
            else if (gameState.suspicion > 70) currentEmotion = 'suspicious';

            typeWriter(openingText);
            setQinEmotion(currentEmotion);
            speakQin(openingText, currentEmotion);

            updateStatsUI();
            renderChoices(data.choices);
        }

        function renderChoices(choices) {
            els.choices.innerHTML = '';
            choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                
                let text = choice.text;
                if (choice.land_give > 0) {
                    text = `<span class="land-badge">å‰²åœ°</span> ${text}`;
                }
                btn.innerHTML = text;
                
                if (choice.land_give > 0 && gameState.landCount <= 0) {
                    btn.disabled = true;
                    btn.innerHTML += " <br><small>(ç„¡åœ°å¯å‰² No land left)</small>";
                }
                
                btn.onclick = () => makeChoice(choice);
                els.choices.appendChild(btn);
            });
        }

        function makeChoice(choice) {
            // 1. æ›´æ–°æ•¸å€¼
            gameState.anger = clamp(gameState.anger + choice.anger);
            gameState.greed = clamp(gameState.greed + choice.greed);
            gameState.suspicion = clamp(gameState.suspicion + choice.suspicion);
            if (choice.land_give) gameState.landCount -= choice.land_give;
            if (choice.alliance) gameState.alliance_mentions++;

            updateStatsUI();

            // 2. éœ‡å‹•æ•ˆæœ
            if (choice.anger > 5 || choice.emotion === 'angry') {
                els.avatarWrapper.classList.add('shake');
                setTimeout(() => els.avatarWrapper.classList.remove('shake'), 400);
            }

            // 3. é¡¯ç¤ºå›æ‡‰èˆ‡æ’­æ”¾èªéŸ³
            const replyEmotion = choice.emotion || 'normal';
            typeWriter(choice.qin_reply);
            setQinEmotion(replyEmotion);
            speakQin(choice.qin_reply, replyEmotion);

            // 4. æ¸…ç©ºé¸é …ï¼Œé¡¯ç¤ºã€Œä¸‹ä¸€æ­¥ã€æŒ‰éˆ•
            els.choices.innerHTML = '';
            
            const nextBtn = document.createElement('button');
            nextBtn.className = 'choice-btn next-btn';
            nextBtn.innerText = 'é»æ“Šç¹¼çºŒ (Next) â–¶';
            
            nextBtn.onclick = () => {
                // åœæ­¢èªéŸ³
                if(synth) synth.cancel();

                // åˆ¤æ–·æ˜¯å¦éŠæˆ²çµæŸ
                if (gameState.anger >= 100 || gameState.greed >= 100 || gameState.suspicion >= 100) {
                    showEnding();
                } else {
                    nextRound();
                }
            };
            
            els.choices.appendChild(nextBtn);
        }

        function updateStatsUI() {
            els.bars.anger.style.width = gameState.anger + '%';
            els.bars.greed.style.width = gameState.greed + '%';
            els.bars.suspicion.style.width = gameState.suspicion + '%';
            els.landCount.textContent = gameState.landCount;
            els.landCount.style.color = gameState.landCount === 0 ? '#ff3b30' : 'inherit';
        }

        function setQinEmotion(type) {
            els.qinImg.src = emotionImages[type] || emotionImages['normal'];
        }

        function typeWriter(text) {
            els.dialogue.textContent = text;
            els.dialogue.parentElement.style.animation = 'none';
            els.dialogue.parentElement.offsetHeight; 
            els.dialogue.parentElement.style.animation = 'popIn 0.3s ease-out';
        }

        function clamp(val) { return Math.max(0, Math.min(100, val)); }

        function checkEnding() { showEnding(); }

        // --- çµå±€é‚è¼¯ ---
        function showEnding() {
            els.game.style.display = 'none';
            els.ending.style.display = 'flex';
            
            if(synth) synth.cancel();
            
            let endingTitleText, endingContentText, endingAnalysisText;
            
            if (gameState.alliance_mentions >= 2 && gameState.landCount >= 2 && 
                gameState.anger < 80 && gameState.suspicion < 80) {
                // çµå±€ C
                endingTitleText = 'ğŸ¯ çµå±€ Cï¼šç‡•é½Šè¯ç›Ÿå‹‰å¼·è‡ªä¿ (Alliance with Qi Saves Yan)';
                endingContentText = `
                    <p>ä½ å†’éšªè¯åˆé½Šåœ‹ (ally with Qi)ï¼ŒæˆåŠŸæ‹–ä½ç§¦è»ã€‚ç‡•åœ‹é›–ç„¶æå¤±å¾ˆå¤§ï¼Œä½†è‡³å°‘ä¿ä½äº†æœ€å¾Œä¸€ç·šç”Ÿæ©Ÿ (last hope)ã€‚</p>
                    <p>é€™ç¨®çµå±€éå¸¸ç½•è¦‹ï¼Œä½†ä¹Ÿè­‰æ˜è¯åˆæŠ—ç§¦ (unite against Qin) é›–ç„¶å›°é›£ï¼Œä½†ä¸æ˜¯å®Œå…¨ä¸å¯èƒ½ã€‚</p>
                    <p style="margin-top:10px; font-size:12px; color:#ccc;"><strong>æœ€çµ‚æ•¸å€¼ï¼š</strong> æ†¤æ€’ ${gameState.anger} | è²ªå©ª ${gameState.greed} | æˆ’å¿ƒ ${gameState.suspicion}</p>
                    <p style="font-size:12px; color:#ccc;"><strong>å‰©é¤˜å‰²åœ°ï¼š</strong> ${gameState.landCount} æ¬¡ | <strong>è¯åˆæåŠï¼š</strong> ${gameState.alliance_mentions} æ¬¡</p>
                `;
                endingAnalysisText = `
                    <h3 style="color:#ff5f6d; margin-bottom:5px;">ğŸ“š ã€Šå…­åœ‹è«–ã€‹å•Ÿç¤º</h3>
                    <p>æ­å–œä½ é”æˆäº†æœ€ä½³çµå±€ï¼ä½ çš„ç­–ç•¥å®Œç¾é«”ç¾äº†ã€Šå…­åœ‹è«–ã€‹çš„æ ¸å¿ƒæ€æƒ³ï¼š</p>
                    <p>âœ… <strong>åˆç¸±æŠ—ç§¦ (Unite against Qin)ï¼š</strong>ä½ æˆåŠŸè¯åˆé½Šåœ‹ï¼Œå½¢æˆæŠ—ç§¦è¯ç›Ÿã€‚</p>
                    <p>âœ… <strong>æ‹’çµ•å‰²åœ° (Refuse land cession)ï¼š</strong>ä½ æ²’æœ‰é€šéå‰²åœ°ä¾†æ›å–æš«æ™‚çš„å’Œå¹³ã€‚</p>
                    <p>âœ… <strong>å¤–äº¤æ™ºæ…§ (Diplomatic wisdom)ï¼š</strong>ä½ åœ¨è«‡åˆ¤ä¸­ä¿æŒäº†é©ç•¶çš„å¼·ç¡¬èˆ‡å¦¥å”ã€‚</p>
                    <p style="font-style:italic; color:#ffd700; margin-top:5px;">ã€Œä»¥è³‚ç§¦ä¹‹åœ°å°å¤©ä¸‹ä¹‹è¬€è‡£ï¼Œä»¥äº‹ç§¦ä¹‹å¿ƒç¦®å¤©ä¸‹ä¹‹å¥‡æ‰ï¼Œä½µåŠ›è¥¿å‘ï¼Œå‰‡å¾æç§¦äººé£Ÿä¹‹ä¸å¾—ä¸‹å’½ä¹Ÿã€‚ã€â€”â€”è˜‡æ´µ</p>
                `;
            } else if (gameState.anger >= 80 || gameState.suspicion >= 80) {
                // çµå±€ A
                endingTitleText = 'âš”ï¸ çµå±€ Aï¼šç§¦åœ‹æ»…ç‡• (Qin Destroys Yan)';
                endingContentText = `
                    <p>ç§¦ç‹çš„æ†¤æ€’å€¼æˆ–æˆ’å¿ƒå€¼éé«˜ï¼Œå†ä¹Ÿç„¡æ³•å®¹å¿ç‡•åœ‹çš„æ…‹åº¦ã€‚</p>
                    <p>ç§¦åœ‹å¤§è»å£“å¢ƒï¼Œç‡•åœ‹è»éšŠæ ¹æœ¬ç„¡åŠ›æŠµæŠ—ã€‚å¹¾å€‹æœˆå…§ï¼Œç‡•åœ‹éƒ½åŸè¢«æ”»ç ´ï¼Œç‡•ç‹è¢«ä¿˜ï¼Œäººæ°‘æµé›¢å¤±æ‰€ã€‚</p>
                    <p style="margin-top:10px; font-size:12px; color:#ccc;"><strong>æœ€çµ‚æ•¸å€¼ï¼š</strong> æ†¤æ€’ ${gameState.anger} | è²ªå©ª ${gameState.greed} | æˆ’å¿ƒ ${gameState.suspicion}</p>
                `;
                endingAnalysisText = `
                    <h3 style="color:#ff5f6d; margin-bottom:5px;">ğŸ“š ã€Šå…­åœ‹è«–ã€‹å•Ÿç¤º</h3>
                    <p>ä½ çš„çµå±€å°è­‰äº†è˜‡æ´µçš„è§€é»ï¼š</p>
                    <p>âŒ <strong>éåº¦æŠ—æ‹’å°è‡´æ»…äº¡ï¼š</strong>é›–ç„¶ä¸é¡˜å‰²åœ°æ˜¯å°çš„ï¼Œä½†æ²’æœ‰é…åˆé©ç•¶çš„å¤–äº¤ç­–ç•¥ã€‚</p>
                    <p>âŒ <strong>å­¤è»å¥®æˆ°ï¼š</strong>æ²’æœ‰å°‹æ±‚å…¶ä»–åœ‹å®¶çš„æ”¯æ´ï¼Œå–®ç¨å°æŠ—å¼·ç§¦å¿…ç„¶å¤±æ•—ã€‚</p>
                    <p>âŒ <strong>æ¿€æ€’å¼·æ¬Šï¼š</strong>åœ¨å¯¦åŠ›æ‡¸æ®Šçš„æƒ…æ³ä¸‹ï¼Œéåº¦å¼·ç¡¬æœƒæ‹›è‡´æ»…é ‚ä¹‹ç½ã€‚</p>
                    <p style="font-style:italic; color:#ffd700; margin-top:5px;">ã€Œä»¥åœ°äº‹ç§¦ï¼ŒçŒ¶æŠ±è–ªæ•‘ç«ï¼Œè–ªä¸ç›¡ï¼Œç«ä¸æ»…ã€‚ã€â€”â€”è˜‡æ´µ</p>
                `;
            } else if (gameState.greed >= 80 || gameState.landCount === 0) {
                // çµå±€ B
                endingTitleText = 'ğŸ´ çµå±€ Bï¼šç§¦åœ‹åä½µç‡• (Qin Annexes Yan)';
                endingContentText = `
                    <p>ç‡•åœ‹ç‚ºäº†æ±‚å’Œï¼Œä¸æ–·å‰²åœ°è³„è³‚ (bribe with land) ç§¦åœ‹ã€‚ç„¶è€Œï¼Œç§¦ç‹çš„è²ªå©ªæ°¸ç„¡æ­¢å¢ƒã€‚</p>
                    <p>æœ€çµ‚ï¼Œç‡•åœ‹é ˜åœŸæ‰€å‰©ç„¡å¹¾ï¼Œåœ‹åŠ›è¡°å¼±åˆ°ç„¡æ³•è‡ªä¿ã€‚ç§¦åœ‹ä¸è²»ä¸€å…µä¸€å’ï¼Œå°±å°‡ç‡•åœ‹å®Œå…¨åä½µã€‚</p>
                    <p style="margin-top:10px; font-size:12px; color:#ccc;"><strong>æœ€çµ‚æ•¸å€¼ï¼š</strong> æ†¤æ€’ ${gameState.anger} | è²ªå©ª ${gameState.greed} | æˆ’å¿ƒ ${gameState.suspicion}</p>
                `;
                endingAnalysisText = `
                    <h3 style="color:#ff5f6d; margin-bottom:5px;">ğŸ“š ã€Šå…­åœ‹è«–ã€‹å•Ÿç¤º</h3>
                    <p>é€™æ­£æ˜¯ã€Šå…­åœ‹è«–ã€‹çš„æ ¸å¿ƒæ•™è¨“ï¼ä½ çš„çµå±€å®Œç¾è©®é‡‹äº†è˜‡æ´µçš„è§€é»ï¼š</p>
                    <p>âŒ <strong>ä»¥åœ°äº‹ç§¦ï¼š</strong>ä½ é¸æ“‡å‰²åœ°æ±‚å’Œï¼Œä½†é€™åªæ˜¯é£²é´†æ­¢æ¸´ã€‚</p>
                    <p>âŒ <strong>åŠ©é•·æ•µäººï¼š</strong>æ¯ä¸€æ¬¡å‰²åœ°éƒ½è®“ç§¦åœ‹æ›´å¼·å¤§ï¼Œç‡•åœ‹æ›´è™›å¼±ã€‚</p>
                    <p>âŒ <strong>è²ªå©ªç„¡æ­¢å¢ƒï¼š</strong>ç§¦ç‹çš„é‡å¿ƒæ°¸é ä¸æœƒè¢«æ»¿è¶³ï¼Œåªæœƒè¶Šä¾†è¶Šå¤§ã€‚</p>
                    <p style="font-style:italic; color:#ffd700; margin-top:5px;">ã€Œè³‚ç§¦è€ŒåŠ›è™§ï¼Œç ´æ»…ä¹‹é“ä¹Ÿã€‚ã€â€”â€”è˜‡æ´µ</p>
                `;
            } else {
                // é»˜èªå¤±æ•—
                endingTitleText = 'âš”ï¸ çµå±€ Aï¼šç§¦åœ‹æ»…ç‡• (Qin Destroys Yan)';
                endingContentText = `
                    <p>ç¶“éåè¼ªè‰±é›£çš„è«‡åˆ¤ï¼Œç‡•åœ‹æœ€çµ‚é‚„æ˜¯ç„¡æ³•é€ƒè„«ç§¦åœ‹çš„é­”æŒã€‚</p>
                    <p>ç§¦åœ‹æ‰¾åˆ°æ©Ÿæœƒï¼Œå¤§è»å£“å¢ƒã€‚ç‡•åœ‹é›–ç„¶å¥®åŠ›æŠµæŠ—ï¼Œä½†å¯¡ä¸æ•µçœ¾ï¼Œæœ€çµ‚æ»…äº¡ã€‚</p>
                    <p style="margin-top:10px; font-size:12px; color:#ccc;"><strong>æœ€çµ‚æ•¸å€¼ï¼š</strong> æ†¤æ€’ ${gameState.anger} | è²ªå©ª ${gameState.greed} | æˆ’å¿ƒ ${gameState.suspicion}</p>
                `;
                endingAnalysisText = `
                    <h3 style="color:#ff5f6d; margin-bottom:5px;">ğŸ“š ã€Šå…­åœ‹è«–ã€‹å•Ÿç¤º</h3>
                    <p>ä½ çš„çµå±€åæ˜ äº†æˆ°åœ‹æ™‚ä»£çš„æ®˜é…·ç¾å¯¦ï¼š</p>
                    <p>âš ï¸ <strong>å–®æ‰“ç¨é¬¥æ³¨å®šå¤±æ•—ï¼š</strong>æ²’æœ‰èˆ‡å…¶ä»–åœ‹å®¶è¯ç›Ÿï¼Œç‡•åœ‹å­¤ç«‹ç„¡æ´ã€‚</p>
                    <p>âš ï¸ <strong>ç­–ç•¥ä¸ç•¶ï¼š</strong>è©¦åœ–è³„è³‚ç§¦ç‹ä»¥æ±‚ç”Ÿå­˜æ™‚é–“ï¼Œæ˜¯é‡å¤§çš„æˆ°ç•¥å¤±ç­–ã€‚é€™åªèƒ½ç²å¾—ä¸€æ™‚çš„ç”Ÿå­˜ï¼Œå»ç„¡æ³•è§£æ±ºæ ¹æœ¬çŸ›ç›¾ï¼Œæœ€çµ‚ä»é€ƒä¸æ‰æ»…äº¡çš„å‘½é‹ã€‚</p>
                    <p style="font-style:italic; color:#ffd700; margin-top:5px;">ã€Œå…­åœ‹ç ´æ»…ï¼Œéå…µä¸åˆ©ã€æˆ°ä¸å–„ï¼Œå¼Šåœ¨è³‚ç§¦ã€‚ã€â€”â€”è˜‡æ´µ</p>
                `;
            }
            
            els.endingTitle.textContent = endingTitleText;
            els.endingContent.innerHTML = endingContentText;
            els.endingAnalysis.innerHTML = endingAnalysisText;
        }
    </script>
</body>
</html>